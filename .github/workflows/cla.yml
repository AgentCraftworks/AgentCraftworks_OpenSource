name: CLA Assistant

# Manages Contributor License Agreement signatures via PR comments.
# Stores signatures in the cla-signatures branch and comments on PRs.
# Engagement Level: T3 (Peer Programmer) â€” writes CLA signature files and PR comments.

on:
  issue_comment:
    types: [created]
  pull_request_target:
    types: [opened, closed, synchronize]

permissions:
  contents: write
  pull-requests: write
  actions: read

jobs:
  cla_assistant:
    runs-on: ubuntu-latest
    if: |
      (github.event.comment.body == 'I have read the CLA Document and I hereby sign the CLA.') ||
      (github.event_name == 'pull_request_target' && github.event.action != 'closed')
    steps:
      - name: Generate GitHub App Token
        id: app-token
        uses: actions/create-github-app-token@v1
        with:
          app-id: ${{ secrets.GH_APP_ID }}
          private-key: ${{ secrets.GH_APP_PRIVATE_KEY }}

      - name: CLA Assistant
        uses: contributor-assistant/github-action@v2.6.1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PERSONAL_ACCESS_TOKEN: ${{ steps.app-token.outputs.token }}
        with:
          path-to-signatures: "signatures/version1/cla.json"
          path-to-document: "https://github.com/AgentCraftworks/AgentCraftworks-CE/blob/main/.github/CLA.md"
          branch: "cla-signatures"
          allowlist: bot*,dependabot[bot],github-actions[bot]
          create-file-commit-message: "chore: store CLA signatures"
          signed-commit-message: "chore: CLA signed by @$contributorName"
          custom-notsigned-prcomment: |
            Thank you for your contribution! Before we can merge this PR, please sign our [Contributor License Agreement](.github/CLA.md).

            To sign, add a comment to this PR with the following text:

            > I have read the CLA Document and I hereby sign the CLA.

            You only need to sign once.
